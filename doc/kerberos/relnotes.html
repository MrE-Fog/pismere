<html>
<head>
<title>
Release Notes for Kerberos for Windows 2.1
</title>
</head>

<body>

<center>
<h1>Kerberos for Windows 2.1</h1>
<p>
<h2>Release Notes</h2>
<p>
<h3>December 4, 2000</h3>

</center>

<h3>Table of Contents</h3>

<ul type=disc>
<li><a href="#intro">Introduction</a>
<li><a href="http://web.mit.edu/kerberos/www/">What is Kerberos?</a>
<li><a href="#whatsnew">What's New</a>
<li><a href="#issues">Known Issues</a>
<li><a href="#build">Building</a>
<li><a href="#config">Installation and Configuration</a>
<li><a href="#command_line">Command Line Options to Leash32, kinit, klist, and kdestroy</a>
<li><a href="#todo">To Do</a>
<li><a href="#devnotes">Developer Notes</a>
</ul>

<!-- ---------------------------------------------------------------------- -->
<hr>
<a name="intro"></a>
<h2>Introduction</h2>

<p><em>Kerberos for Windows</em> (or <em>KfW</em> for short) is the
integrated release of Kerberos version 4 and Kerberos version 5 (or
Kerberos 4 and Kerberos 5 for short -- also Kerberos v4 and Kerberos
v5).

<!-- http://www.geek.com/glossary/glossary_search.cgi?protocol -->
<!-- http://www.m-w.com/cgi-bin/dictionary?protocol -->

<p>Kerberos 4 and Kerberos 5 refers to the versions 4 and 5 of the
Kerberos protocol.  (A <a
href="http://www.whatis.com/WhatIs_Definition_Page/0,4152,212839,00.html">protocol</a>
refers to how data is transmitted on a network.)  KfW includes both of
these.  KfW 2.1, in particular, includes the <a
href="http://web.mit.edu/kerberos/www/">MIT Kerberos v5 Release
1.2.1</a> and KfW's own release of Kerberos v4.

<p>

<!-- ---------------------------------------------------------------------- -->
<hr>
<a name="whatsnew"></a>
<h2>What's New</h2>


<ul>

<p>
<li>
"Kerberos for Win32" is now "Kerberos for Windows", or "KfW" for short.

<p>
<li>
Kerberos v4 and v5 now build with <a href="#dns">DNS support</a> by
default.

<p>
<li>
Kerberos v5 support is from MIT Kerberos v5 Release 1.2.1.

<p>
<li>
Various buffer overflow vulnerabilities in Kerberos 4 have been fixed.

<p>
<li>
The in-memory Kerberos Credentials Cache implementation is brand new.
Fleavius is now obsolete.  In-memory credentials cache is now
implemented via a LRPC (local remote procedure call) mechanism.  The
tickets live in the krbcc32s process (which is automatically started).
On Windows NT/2000, There is at most one such process per Windows
login session.
<p>
Each Windows NT/2000 login session can access only its own credentials
cache.  Even Windows NT/2000 security impersonation will not allow a
process to access the cache of the user the process is impersonating.
This is by design.
<p>
This implementation has a much smaller memory footprint and is far
more robust than the fleavius implementation.  It can support a very
large number of caches and credentials.  The only downside to the LRPC
implementation is that it is currently about 35% slower than the
fleavius implementation.
<p>
For more information, read the <a
href="../../athena/auth/krbcc/doc/architecture.txt">krbcc32
Architecture</a> and <a
href="../../athena/auth/krbcc/doc/implementation.txt">krbcc32
Implementation</a> documentation at
<code>athena/auth/krbcc/doc/architecture.txt</code> and
<code>athena/auth/krbcc/doc/implementation.txt</code>.
</ul>

<!-- ---------------------------------------------------------------------- -->
<hr>
<a name="issues"></a>
<h2>Known Issues</h2>

<ul>

<p>
<li>The Kerberos Credentials Cache implementation does not support
locking across calls.  Each call is atomic, however.

<p>
<li>If the krbcc32s LRPC server process is ever terminated while
another process is supposed to have a valid handle to it, the other
process will need to grab new handles.  The moral of the story is:
do not kill krbcc32s if you have any such processes around (e.g., if
Leash is running).  In fact, you generally should never have to kill
krbcc32s.

<p>
<li>If writing a server that uses Kerberos and might use the Kerberos
Credentials Cache as opposed to the Kerberos v5 file credentials cache
(<code>FILE:</code>), please read the <a
href="../../athena/auth/krbcc/doc/architecture.txt">krbcc32
Architecture</a> documentation.

</ul>

<!---------------------------------------------------------------------------->
<hr>
<a name="build">
<h2>Building the Sources</h2>
</a>

<p>First, make sure that you have Microsoft Visual C++ 6.0, a recent
release of the <a
href="http://msdn.microsoft.com/downloads/sdks/platform/default.asp">Microsoft
Platform SDK</a> (July 2000 or higher is known to work), <a
href="http://www.activestate.com/">ActiveState Perl</a> (build 517 or
higher), sed, gawk, cat, and rm in your PATH.  You can get sed, gawk,
cat, and rm from the <a
href="http://sourceware.cygnus.com/cygwin/">Cygwin distribution</a>.
Also make sure that your INCLUDE path includes the Microsoft Platform
SDK before the Microsoft Visual C++ include files and that perl has
been installed so that .pl files are automatically executed with perl.
You will probably also need to be using the default system shell (cmd
or command, depending on whether you're running NT/2000 or 9x/Me) so
that the Makefiles work properly.

<p>
Then, go into the <code>athena</code> directory and type

<blockquote><code>..\scripts\build.pl --softdirs</code></blockquote>

to build everything with debug information.  For a release build, run

<blockquote><code>..\scripts\build.pl --softdirs NODEBUG=1</code></blockquote>

For help, do

<blockquote><code>..\scripts\build.pl -?</code></blockquote>

and

<blockquote><code>..\scripts\build.pl --docs</code><br><em>[NOTE: does not work in 9x/Me]</em></blockquote>

If you are running 9x/Me, you will need to invoke the build.pl script
using perl.  For example:

<blockquote><code>perl ..\scripts\build.pl [args]</code></blockquote>

If krb5 does not build properly, it is probably because sed/gawk were
not in your path.  To fix this, delete
<code>athena/auth/krb5/src/Makefile</code>, fix your
<code>PATH</code>, and try again.

<p>
To make your life easier, you might try putting the
<code>scripts</code> directory in your path.  (Under 9x/Me, that will
not help you since you always need to invoke the script through perl.)

<p>
If you use the <code>build.pl</code> script, the targets should
get copied into the <code>target</code> directory at the same level as
the <code>athena</code> directory.  You can go into
<code>target\bin\i386\dbg</code> (replacing <code>i386</code> with the
right CPU and <code>dbg</code> with <code>rel</code> if building
release targets), and run the binaries.  The debug symbols for the
debug build also get placed there in case you need to debug.

<!-- ---------------------------------------------------------------------- -->
<hr>
<a name="config"></a>
<h2>Installation/Configuration</h2>

<h4>Table of Contents</h4>

<ul>
<li><a href="#config_bin">Binaries</a>
<li><a href="#config_files">Kerberos Configuration Files</a>
<li><a href="#config_krb4">Modifying Kerberos 4 Configuration Files</a>
<li><a href="#config_krb5">Modifying Kerberos 5 Configuration File</a>
<li><a href="#config_services">Services File</a>
<li><a href="#config_cache">Ticket Cache</a>
<li><a href="#config_time">Date and Time Issues</a>
</ul>

<P>

<!-- ---------------------------------------------------------------------- -->
<hr>
<a name="config_bin"></a>
<h3>Binaries</h3>

<ul>
<li>krbv4w32.dll - Kerberos 4
<li>krbcc32.dll  - required by Kerberos 4, used by Kerberos 5 as well
<li>krbcc32s.exe - required by krbcc32.dll
<li>kclnt32.dll  - required by some Kerberos 4 applications
<li>krb5_32.dll  - Kerberos 5
<li>leash32.exe  - Leash32 Integrated Kerberos ticket manager
<li>leashw32.dll - used by Leash32
<li>xpprof32.dll - used by Leash32
<li>comerr32.dll - used by Leash32 and Kerberos 5
<li>gssapi32.dll - GSS API for Kerberos 5
<li>wshelp32.dll - winsock helper used by various things
<li>kinit.exe    - command-line app to get Kerberos tickets
<li>klist.exe    - command-line app to list Kerberos tickets
<li>kdestroy.exe - command-line app to destroy Kerberos tickets
</ul>

<p>
We recommend to developers that the binaries have a single Kerberos
directory that is on the user's path.

<!-- ---------------------------------------------------------------------- -->
<hr>
<a name="config_files"></a>
<h3>Kerberos Configuration Files</h3>

<p>
Kerberos 5 needs a single configuration file: <code>krb5.ini</code>.
You can put it in the same directory as the DLL and everything will
work fine.  You can also put it in the Windows directory.  You can
even point to an arbitrary file by setting the
<code>KRB5_CONFIG</code> environment variable.

<p>
Kerberos 4 needs two configuration files, typically called
<code>krb.con</code> and <code>krbrealm.con</code>.  You can put these
files in the same directory as the DLL and everything should work.
You can also set KRB4_KRB.REALMS or KRB4_KRB.CONF to override each
file.  Or you can set KRB4_CONFIG to force Kerberos 4 to look for both
files in a particular directory.  If you do none of these, this is
where Kerberos 4 will search:

<ol>
<li>%NDIR%\kerb\
<li>The current directory
<li>The Windows directory
<li>The Windows system directory
<li>The directory containing the executable file for the current task
<li>The directories in the path (<a href="#c1"><b>*</b></a>)
<li>The list of directories mapped in a network
<li>%NDIR%\
<li>%ETC%\
</ol>

<p>
(<a name="c1"><b>*</b></a>) Note: If you put the files in the DLL's
directory, this part of the search is what will take you there.  If
you have another config file earlier in the search, that will take
precedence, so be careful.

<!-- ---------------------------------------------------------------------- -->
<hr>
<a name="config_krb4"></a>
<h3>Modifying Kerberos 4 Configuration Files</h3>

<p>
Note: You can use Leash32 to edit the Kerberos 4 configuration files.

<p>
It is anticipated that most sites using Kerberos version 4 on Windows
also will have an existing UNIX Kerberos infrastructure.  For that
reason, we kept the format of the <code>krb.con</code> identical to
the UNIX <code>krb.conf</code> and the format of
<code>krbrealm.con</code> identical to the UNIX
<code>krb.realms</code>.  For many users, the easiest way to configure
these files for use at their local sites will be to ftp the
corresponding files from a local UNIX machine that is already properly
configured.

<p>
The <code>krb.con</code> file contains configuration information
describing the Kerberos realm and the Kerberos key distribution center
(KDC) servers for known realms.

<p>
<code>krb.con</code> contains the name of the local realm in the first
line, followed by lines indicating realm/host entries. The first token
is a realm name, and the second is a hostname of a host running a KDC
for that realm. The words "admin server" following the hostname
indicate that the host also provides an administrative database server
which is contacted when changing a user's password. For example:

<pre>
ATHENA.MIT.EDU
ATHENA.MIT.EDU kerberos.mit.edu admin server
ATHENA.MIT.EDU kerberos-1.mit.edu
ATHENA.MIT.EDU kerberos-2.mit.edu
LCS.MIT.EDU kerberos.lcs.mit.edu admin server
</pre>

<p>
If this were your <code>krb.con</code> file and you wanted to change
the default local realm to <code>CIT.CORNELL.EDU</code> you would edit
it to look like:

<pre>
CIT.CORNELL.EDU
CIT.CORNELL.EDU kerberos.cit.cornell.edu admin server
ATHENA.MIT.EDU kerberos.mit.edu admin server
ATHENA.MIT.EDU kerberos-1.mit.edu
ATHENA.MIT.EDU kerberos-2.mit.edu
LCS.MIT.EDU kerberos.lcs.mit.edu admin server
</pre>

<p>
The <code>krbrealm.con</code> file is the host-to-Kerberos realm
translation file. This provides a translation from a local hostname to
the Kerberos realm name for the services provided by that host.

<p>
Each line of the translation file is in one the following forms
(domain_name should be of the form <code>.XXX.YYY</code>, e.g.,
<code>.LCS.MIT.EDU</code>):

<pre>
	host_name kerberos_realm
	domain_name kerberos_realm
</pre>

<p>
If a hostname exactly matches the host_name field in a line of the
first form, the corresponding realm is the realm of the host. If a
hostname does not match any host_name in the file, but its domain
exactly matches the domain_name field in a line of the second form,
the corresponding realm is the realm of the host.

<p>
If no translation entry applies, the host's realm is considered to be
the hostname's domain portion converted to uppercase.

<!-- ---------------------------------------------------------------------- -->
<hr>
<a name="config_krb5"></a>
<h3>Modifying Kerberos 5 Configuration File</h3>

<p>
Note: Leash32 can be used to edit the Kerberos 5 configuration file.

<p>
See the Kerberos 5 documentation in athena/auth/krb5/doc for further
documentation on Kerberos 5.

<!-- ---------------------------------------------------------------------- -->
<hr>
<a name="config_services"></a>
<h3>Services File</h3>

<p>
The Kerberos DLLs need to know what port to use to talk to the
Kerberos server.  Kerberos 4 now defaults to ports 750 (kerberos
750/udp kdc) and 751 (kerberos-master 751/tcp) if there are no
kerberos or kerberos-master entries in the services file.  Kerberos 5
also has proper defaults (port 88 with a fallback to 750) in case the
services file is missing the entries for kerberos and kerberos-sec.

<p>
If your site uses non-standard ports, you will still need a services
file appropriate for your site.

<!-- ---------------------------------------------------------------------- -->
<hr>
<a name="config_cache"></a>
<h3>Ticket Cache</h3>

<p>
The new default for Kerberos 4 and 5 is to store their tickets in
memory.

<p>
You can specify the name of the ticket file and the directory in which
it is stored via the environment variables <code>KRBTKFILE</code>
(krb4) and <code>KRB5CCNAME</code> (krb5).  The krb4 credentials
always go into memory.  The ticket string you see always has an
&quot;API:&quot; in front of it.

<p>
There are also registry settings for these locations.  Playing with
Leash32 will reveal where they are (look in
HKCU\Software\MIT\Kerberos4 and Kerberos5).  You can set machine-wide
values by playing with these settings in HKLM.

<p>
Kerberos 5 does support using file-based tickets, but we do not
recommend this, as it is less secure.

<!-- ---------------------------------------------------------------------- -->
<hr>
<a name="config_time"></a>
<h3>Date and Time issues</h3>

<P>
<i>Why Kerberos cares what time it is...</i>

<p>
Kerberos authentication uses time stamps as part of its
protocol. When the clocks of the Kerberos server and your computer are
too far out of synchronization, you cannot authenticate properly. Both
the Kerberos server and the Kerberos client depend on having clocks
that are synchronized within a certain margin. This margin is normally
5 minutes.

<p>
The date and time on the machine running Kerberos must be
&quot;accurately&quot; set.  If the date or time is off &quot;too
far&quot;, Kerberos authentication will not work.

<p>
You can synchronize your clock using Leash32.  It allows you to set
the name of the host to which you will synchronize.  It saves this
information in the registry (under HKCU\Software\MIT\Leash32 -- you
can set machine-wide defaults in HKLM).

<p>
By default, the server that the libraries contact when synchronizing
the time is <code>time</code>. The domain name has been left off on
purpose.  If local system administrators create a machine with a CNAME
of time within the local domain the clients will contact this machine
by default.

<p>
If local system administrators are opposed to doing this for some
reason, you can edit the resource <code>LSH_TIME_HOST</code> in the
<code>leashw32.dll</code> to the name appropriate for your local site.
You can also edit the header files from the source distribution and
recompile for your local site.  However, this is not recommended.  You
can also tweak the registry setting Leash32 uses.

<p>
You can also avoid this problem by running a local, properly
configured, NTP program on your machine.


<!-- ---------------------------------------------------------------------- -->
<hr>
<a name="command_line"></a>
<h2>Command Line Options to Leash32, kinit, klist, and kdestroy</h2>

<p>
The command line options for <b>Leash32</b> are:
<pre>
	-kinit, -i	only perform a kinit and then exit Leash
</pre>

<p>
The options for kinit, klist, and kdestroy can be viewed by typing the
name of the utility followed by <code>-?</code> (e.g., <code>kinit
-?</code>).

<!-- ---------------------------------------------------------------------- -->
<hr>
<a name="todo"></a>
<h2>To Do</h2>

<ul>

<p>
<li>
The tf_close() in tf_save_cred() still puzzles the developer.  We
should figure out what the spec is supposed to be there (if there is
supposed to be one at all) and document the heck out of it. :)

<p>
<li>
Make Kerberos 4 thread-safe and investigate whether Kerberos 5 is
thread-safe.

<p>
<li>
Use krb5's com_err instead of the krb4 mess we now have.  Make sure
all logging is funneled through one place and provide a way to control
where that goes.

<p>
<li>
A clean Leash API.

</ul>


<!-- ---------------------------------------------------------------------- -->
<hr>
<a name="devnotes"></a>
<h2>Developer Notes</h2>


<a name="devnotes_kclient">
<h3>kclient</h3>
</a>

<ul>

<li>kclient will now try to get tickets for foreign principals if you
pass in a service with a non-local realm.  It will use the service's
realm instead of the default local realm.

<li>kclient now looks in the ticket file for the realm info before looking
for the local default realm.

</ul>

<p>Below is Jeffrey Altmans's explanation of the problem.  We put in a
patch he submitted for the first 2 items in his 3-item solution below.

<blockquote>
<p>
The design of the Kclient interface is so simplified that applications
cannot easily get access to necessary information.  This has resulted
in the need for the Kerberos configuration page in Eudora which
includes fields for:

<pre>
  Realm:          CC.COLUMBIA.EDU
  Service name:   pop
  Service format: %1.%4@%3
</pre>

<p>
The specification of a Realm here without a "Principal name" is
interesting.  

<p>
Some information on my system.  The local realm is KRB5.COLUMBIA.EDU
and the POP server is pop.cc.columbia.edu which is in realm
CC.COLUMBIA.EDU.  With a ticket manager I retrieve a TGT for
CC.COLUMBIA.EDU.  Kstatus.exe reports that I am authenticated.
Kstatus uses the kclnt32.dll interface just as Eudora does.
However, when I ask Eudora to check my mail an interesting thing
happens:

<p>
 GetTicketForService() is called which results in a dialog being
 displayed

<pre>
    Please enter your Network ID and password.

    Network ID: jaltman
    Password:
</pre>

<p>
 So I enter my password for CC.COLUMBIA.EDU and am told sorry but
 the password is incorrect.

<p>
What happened here?

<p>
First, Eudora does not include a field for the principal name to go
along with the realm.  So it does not call SetUserName() which should 
have been set to 
<pre>
  jaltman@CC.COLUMBIA.EDU
</pre>
<p>
to match the realm specified in Eudora for the POP host.  Eudora needs
the realm so it can construct the service ticket name 
<pre>
  pop.mailhub@CC.COLUMBIA.EDU
</pre>
<p>
but without setting the username it has no mechanism to report the
desired realm to kclnt32.dll.
<p>
GetTicketForService() calls an internal function to verify the TGT.
But because no realm has been set and data is not shared between
process boundaries this instance of kclnt32.dll has no idea that the
ticket manager realm is CC.COLUMBIA.EDU.  And instead of attempting to
load the Ticket File Realm it calls krb_get_lrealm().  So it tries to
verify a TGT 
<pre>
  krbtgt.KRB5.COLUMBIA.EDU@KRB5.COLUMBIA.EDU
</pre>
<p>
which does not exist.  So it destroys the existing tickets and then
attempts to get a new TGT for
<pre>
  jaltman
</pre>
<p>
in the default realm which again is KRB5.COLUMBIA.EDU.  But of course
kclnt32.dll does not display the realm in the dialog box so the user
has no idea that kclnt32.dll is confused.
<p>
In order to correct this situation the following needs to be done to
kclnt32.dll:

<ol>
<li>all calls to krb_get_lrealm() should be preceded by an attempt
   to retrieve the realm from the ticket file with
   krb_get_tf_realm().   Only if krb_get_tf_realm() fails should
   krb_get_lream() be called.

<li>if a realm is specified in the GetTicketForService() request 
   that realm should be used for the verification of the TGT.

<li>the dialog box displayed by UserInfo() should append the realm
   to the szNetID (if it is not already part of the string) when
   setting the default value for the box.  This will indicate to
   the user which realm s/he is being authenticated against.
</ol>

<p>
Then the author's of Eudora should add a principal name to the
configuration for Kerberos and call SetUserName() to set the 
principal and realm to the values needed to authenticate against 
the POP server.
</blockquote>


<h3>Registry and Environment Settings</h3>

<pre>
Leash DLL timesync code:
   1. Use TIMEHOST environment value if defined.
   2. Otherwise, use value from registry 
      (HKCU\Software\MIT\Leash\Settings,timehost) if present.
   3. Otherwise, use value from registry 
      (HKLM\Software\MIT\Leash\Settings,timehost) if present.
   4. Otherwise, use resource string if present.
   5. Otherwise, default to #defined value &quot;time&quot;.

Kerberos 4:
A. location of krbrealm &amp; krbconf:
   1. First, check for environment overrides:
      a. Use %KRB4_KRB.REALMS% as full filename for realms file if defined.
      a. Use %KRB4_KRB.CONF% as full filename for config file if defined.
      b. Otherwise, look for krbrealm.con and krb.con in dir %KRB4_CONFIG%.
   2. If nothing defined so far, look in registry:
      a. HKCU\Software\MIT\Kerberos4,krb.realms for realms full pathname.
      a. HKCU\Software\MIT\Kerberos4,krb.conf for config full pathname.
      b. HKCU\Software\MIT\Kerberos4,config as dir for both files.
      c. HKLM\Software\MIT\Kerberos4,krb.realms for realms full pathname .
      c. HKLM\Software\MIT\Kerberos4,krb.conf for config full pathname.
      d. HKLM\Software\MIT\Kerberos4,configdir as dir for both files.
   3. If any of the above are set, we use it even if the files are not there.
      If none of them are set, we use the old krb4 search.

B. ticket file
   1. %KRBTKFILE% if defined
   2. Registry setting, if setting is present
      (HKCU\MIT\Kerberos4,ticketfile)
   3. Registry setting, if setting is present
      (HKLM\MIT\Kerberos4,ticketfile)
   4. Otherwise, &quot;API:krb4cc&quot;.
  (
   If we ever support a file-based cache, we should use this:
   4. %TEMP%\ticket.krb, if var defined and dir exists
   5. %TMP%\ticket.krb, if var defined and dir exists
   6. c:\temp\ticket.krb if c:\temp exists
   7. c:\tmp\ticket.krb if c:\tmp exists
   8. GetWindowsDirectory()\ticket.krb as a last-ditch default?  It's
      either that or c:\ticket.krb!
   )

Kerberos 5:
A. location of krb5.ini:
   1. %KRB5_CONFIG% if defined
   2. (HKCU\Software\MIT\kerberos5,config) if defined
   3. (HKCU\Software\MIT\kerberos5,config) if defined
   4. Otherwise, use GetWindowsDirectory()\krb5.ini
   (do this instead of OpenFile to make things more explicit/simple)

B. credentials cache
   1. %KRB5CCNAME% if defined
   2. (HKCU\Software\MIT\kerberos5,ccname) if defined
   3. (HKLM\Software\MIT\kerberos5,ccname) if defined
   4. If RegKRB5CCNAME is set under [Files] in kerberos.ini,
      look at that path in the registry (code already in krb5 for compat
      with Gradient DCE installations, I believe).
   5. Otherwise, if using CCAPI, default to &quot;API:krb5cc&quot;.
                 if no CCAPI, use &quot;FILE:&quot; with:
      a. %TEMP%\krb5cc, if var defined and dir exists
      b. %TMP%\krb5cc, if var defined and dir exists
      c. c:\temp\krb5cc if c:\temp exists
      d. c:\tmp\krb5cc if c:\tmp exists
      e. GetWindowsDirectory()\krb5cc as a last-ditch default?
         it's either that or c:\krb5cc!
</pre>

<a name="dns">
<h3>Using DNS Lookups for Kerberos Configuration</h3>
</a>

<h4>What is it?</h4>

<p>DNS Lookups provide Kerberos the ability to determine the Kerberos
Realm that a host belongs to and to find the servers associated with a
given Realm by using the Domain Name Service instead of or in addition
to local configuration files.


<h4>When are DNS Lookups used?</h4>

<p>
DNS Lookups are used under two circumstances:

<ol>

<li>No <code>krb.con</code> file is found for Kerberos 4 or no
<code>krb5.ini</code> file is found for Kerberos 5.

<li>The <code>krb.con</code> file or <code>krb5.ini</code> file
contains a command to activate DNS Lookups and the lookup cannot be
answered by data found in the appropriate configuration file.

</ol>

<p>To activate DNS lookups in a <code>krb.con</code> file place a line
that reads:

<blockquote>
<pre>
.KERBEROS.OPTION. dns
</pre>
</blockquote>

<p>
as one of the Realm to Host entries.  When DNS Lookups are used the
first line may be left blank to indicate that the default realm should
be determined by a DNS Lookup.

<p>
To activate DNS lookups in a <code>krb5.ini</code> file place: 

<blockquote>
<pre>
dns_fallback = true
</pre>
</blockquote>

<p>into the <code>[libdefaults]</code> section.  If a "default_realm"
entry is not provided, a DNS lookup will be performed to determine the
default realm.


<h4>What entries go into the DNS?</h4>

<p>Host to realm lookups are performed using DNS TXT records.  Example
records are:

<blockquote>
<pre>
_kerberos.yclept.kermit.columbia.edu.  IN TXT "KRB5.COLUMBIA.EDU"
_kerberos.columbia.edu.                IN TXT "CC.COLUMBIA.EDU"
</pre>
</blockquote>

<p>Realm to server lookups are performed using DNS SRV records.
Example records are:

<blockquote>
<pre>
_kerberos._udp.KRB5.COLUMBIA.EDU.    IN SRV 0 0 750     yclept.kermit.columbia.edu
_kerberos-adm._tcp.KRB5.COLUMBIA.EDU IN SRV 0 0 749     yclept.kermit.columbia.edu
_kpasswd._udp.KRB5.COLUMBIA.EDU      IN SRV 0 0 464     yclept.kermit.columbia.edu
</pre>
</blockquote>

<hr>

<h3>Some older notes from prior releases...</h3>

<ol>

<p>
<li>
Modification of the Kerberos 4 credential cache:
<P>
We encountered a problem at MIT that we felt needed to be addressed
even though it broke some backwards compatibility. We found that if
someone used a Kerberized application spanning multiple PPP sessions a
Kerberos error would be generated and few applications would catch
this error and try to get new tickets instead.  E.g. Suppose a user
starts a PPP connection and then starts Eudora, fetching mail. The
user then decides to close down the PPP connection while they read
their mail and compose responses. Next they initiate a new PPP
connection and incorporate mail again. Note that the user never exited
Eudora. Instead of prompting the user for their name and password
Eudora will generate and error message. The only way for the user to
recover the functionality would be to use Leash, Kview, or kdestroy to
destroy their old tickets so that Eudora would get new tickets.
<P>
This happened because many ISPs hand out a new IP address to a user
each time that user reconnects to the system. Also a Kerberos ticket
includes the machines local IP address in an encrypted form this is
used by most severs to insure that the ticket has not been copied to
another users machine.
<P>
Since the local IP address is stored in the ticket it seems that it
should be easy to compare this data to the machine's local IP address
at the same time that an application is checking to see if the ticket
has expired. Unfortunately the IP address in the ticket is encrypted
in the server's session key and so is inaccessible to the local
machine.
<P>
Instead we borrowed an idea from Kerberos version 5 and decided to
store the local IP address, unencrypted, in the credential which is
cached in the local cache. Within the Kclient function IsCredExpired()
or the krbv4wXX.dll function kchktkt we verify that the ticket has not
expired and that the local IP address matches the IP address stored in
the ticket.
<P>
This implies that machines with multiple copies of kclnt32.dll or
krbv4w32.dll, of different versions, may encounter unexpected errors
when using Kerberized applications. The normal error message generated
will be BAD_TKT_FILE_FORMAT or NO_TKT_FILE.
<P>
Users of applications that use other vendors Kerberos implementations
may also be affected. E.g. some software from FTP, Inc.

<p>
<li>
Add a new function to the Kclient DLL. This function is
SendTicketsForService(). It is basically a send_auth() type
function. Before everyone complains please read the following
explanation.
<P>
Qualcomm has been working with Platinum on a 32-bit Kclient which
would supports both Kerberos v4 and v5. From what I have heard this is
a commercial implementation. It ignores GSS or other abstraction
layers above the Kerberos layer that application developers should
write to. It keeps its ticket cache in the DLL, as such it will not
share the ticket cache with other Kerberos implementations that may
reside on the user's system.
<P>
Platinum and Qualcomm decide to add a new API call to the Kclient
interface. Eudora uses this new function if it finds a KCLNT32.DLL. In
this case it does not use the thunking application KERB16.
<P>
We have duplicated this function in our release of KCLNT32 so that
Eudora will not GPF. Please DO NOT WRITE APPLICATIONS TO THIS
FUNCTION.

<p>
<li>
We stole an idea from Cornell. If the clock is out of synch when we
are trying to obtain a ticket we synchronize the clock and try again. We
inform the user if this occurred.

<p>
<li>
Fixed up some problems relating to DLL initialization. WSAStartup()
will be called if necessary by a few functions. This was needed to
handle some differences in DLL initialization under Win32 when
multiple applications were using the DLL at the same time. Also fixed
up some initialization of the com_err functions due to similar issues.

<p>
<li>
Added two new functions to leashw32.dll.  The first is
Leash_set_help_file(char*szHelpFile) which allows an application
developer to specify which help file to use from the dialog box
presented when using the Leash_kinit() function. If the argument is NULL
the function will check the environment variable KERB_HELP. If this is
not set the hard coded value of kerberos.hlp will be used.  The other
function is Leash_get_help_file() which allows an application developer
to determine the name of the help file being used.  These are defined
in lshfunc.c.

<p>
<li>
Fix the send_auth so that we do not fail on a null realm. Also
detects when an invalid socket descriptor has been passed. (Special
thanks to Eudora 3.0 for providing a test case.)

</ol>

</body>
</html>
